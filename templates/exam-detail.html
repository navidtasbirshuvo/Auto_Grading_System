{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>GradeMentor AI - Advanced Algorithms Exam</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<link href="{% static 'css/dashboard.css' %}" rel="stylesheet"/>
<style>
.question-nav {
  max-height: 400px;
  overflow-y: auto;
}
.question-number {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.question-number.answered {
  background-color: #10B981;
  color: white;
}
.question-number.current {
  background-color: #4F46E5;
  color: white;
}
.question-number.unanswered {
  background-color: #374151;
  color: #D1D5DB;
}
.question-number:hover {
  transform: scale(1.05);
}
.timer-warning {
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}
</style>
</head>
<body class="d-flex">
<!-- Exam Header -->
<div class="w-100">
<header class="header shadow-sm py-3 px-4 d-flex justify-content-between align-items-center position-fixed w-100" style="z-index: 1000; top: 0;">
<div class="d-flex align-items-center">
<h1 class="fs-5 fw-semibold text-gray-100 mb-0">Advanced Algorithms Exam</h1>
<span class="badge bg-success ms-3">In Progress</span>
</div>
<div class="d-flex align-items-center">
<div class="me-4">
<span class="text-gray-400 small">Question</span>
<span class="text-gray-100 fw-bold ms-1" id="current-question">1</span>
<span class="text-gray-400">of</span>
<span class="text-gray-100 fw-bold ms-1">25</span>
</div>
<div class="me-4">
<span class="text-gray-400 small">Time Remaining:</span>
<span class="text-warning fw-bold ms-1" id="exam-timer">45:23</span>
</div>
<button class="btn btn-custom-secondary btn-sm me-2" onclick="pauseExam()">
<span class="material-icons me-1" style="font-size: 1rem;">pause</span>Pause
</button>
<button class="btn btn-danger btn-sm" onclick="submitExam()">
<span class="material-icons me-1" style="font-size: 1rem;">send</span>Submit
</button>
</div>
</header>

<!-- Main Content -->
<div class="d-flex w-100" style="margin-top: 80px;">
<!-- Question Navigation Sidebar -->
<div class="bg-gray-800 p-3" style="width: 250px; min-height: calc(100vh - 80px);">
<h6 class="text-gray-100 mb-3">Question Navigation</h6>
<div class="question-nav">
<div class="d-flex flex-wrap">
<!-- Question numbers will be generated by JavaScript -->
</div>
</div>
<div class="mt-4">
<div class="d-flex align-items-center mb-2">
<div class="question-number answered me-2" style="width: 20px; height: 20px; font-size: 0.75rem;"></div>
<small class="text-gray-400">Answered</small>
</div>
<div class="d-flex align-items-center mb-2">
<div class="question-number current me-2" style="width: 20px; height: 20px; font-size: 0.75rem;"></div>
<small class="text-gray-400">Current</small>
</div>
<div class="d-flex align-items-center">
<div class="question-number unanswered me-2" style="width: 20px; height: 20px; font-size: 0.75rem;"></div>
<small class="text-gray-400">Unanswered</small>
</div>
</div>
</div>

<!-- Question Content -->
<div class="flex-fill p-4 main-content">
<div class="container-fluid">
<!-- Question Card -->
<div class="card custom-card">
<div class="card-body p-4">
<div class="d-flex justify-content-between align-items-start mb-4">
<h5 class="text-gray-100 mb-0">Question 1</h5>
<span class="badge bg-info">Multiple Choice</span>
</div>
<div class="mb-4">
<p class="text-gray-200 fs-6 lh-base">
What is the time complexity of the quicksort algorithm in the average case?
</p>
</div>
<div class="mb-4">
<div class="form-check mb-3 p-3 bg-gray-700 rounded">
<input class="form-check-input" type="radio" name="question1" id="q1a" value="a">
<label class="form-check-label text-gray-200 ms-2" for="q1a">
O(n)
</label>
</div>
<div class="form-check mb-3 p-3 bg-gray-700 rounded">
<input class="form-check-input" type="radio" name="question1" id="q1b" value="b">
<label class="form-check-label text-gray-200 ms-2" for="q1b">
O(n log n)
</label>
</div>
<div class="form-check mb-3 p-3 bg-gray-700 rounded">
<input class="form-check-input" type="radio" name="question1" id="q1c" value="c">
<label class="form-check-label text-gray-200 ms-2" for="q1c">
O(nÂ²)
</label>
</div>
<div class="form-check mb-3 p-3 bg-gray-700 rounded">
<input class="form-check-input" type="radio" name="question1" id="q1d" value="d">
<label class="form-check-label text-gray-200 ms-2" for="q1d">
O(2^n)
</label>
</div>
</div>
<div class="d-flex justify-content-between">
<button class="btn btn-custom-secondary" onclick="previousQuestion()" disabled>
<span class="material-icons me-2">arrow_back</span>Previous
</button>
<div>
<button class="btn btn-custom-secondary me-2" onclick="markForReview()">
<span class="material-icons me-2">flag</span>Mark for Review
</button>
<button class="btn btn-custom-primary" onclick="nextQuestion()">
Next<span class="material-icons ms-2">arrow_forward</span>
</button>
</div>
</div>
</div>
</div>

<!-- Progress Bar -->
<div class="mt-4">
<div class="d-flex justify-content-between align-items-center mb-2">
<span class="text-gray-400 small">Progress</span>
<span class="text-gray-400 small">4% Complete</span>
</div>
<div class="progress" style="height: 8px;">
<div class="progress-bar bg-purple-400" role="progressbar" style="width: 4%" aria-valuenow="4" aria-valuemin="0" aria-valuemax="100"></div>
</div>
</div>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/exam.js' %}"></script>
<script>
// Initialize exam
let currentQuestionIndex = 0;
let totalQuestions = 25;
let timeRemaining = 45 * 60 + 23; // 45:23 in seconds
let answers = {};

// Generate question navigation
function generateQuestionNav() {
    const navContainer = document.querySelector('.question-nav .d-flex');
    for (let i = 1; i <= totalQuestions; i++) {
        const questionBtn = document.createElement('div');
        questionBtn.className = `question-number ${i === 1 ? 'current' : 'unanswered'}`;
        questionBtn.textContent = i;
        questionBtn.onclick = () => goToQuestion(i - 1);
        navContainer.appendChild(questionBtn);
    }
}

// Timer function
function updateTimer() {
    const minutes = Math.floor(timeRemaining / 60);
    const seconds = timeRemaining % 60;
    const timerElement = document.getElementById('exam-timer');
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

    if (timeRemaining <= 300) { // 5 minutes warning
        timerElement.classList.add('timer-warning');
    }

    if (timeRemaining > 0) {
        timeRemaining--;
        setTimeout(updateTimer, 1000);
    } else {
        submitExam();
    }
}

function nextQuestion() {
    if (currentQuestionIndex < totalQuestions - 1) {
        saveCurrentAnswer();
        currentQuestionIndex++;
        loadQuestion(currentQuestionIndex);
    }
}

function previousQuestion() {
    if (currentQuestionIndex > 0) {
        saveCurrentAnswer();
        currentQuestionIndex--;
        loadQuestion(currentQuestionIndex);
    }
}

function goToQuestion(index) {
    saveCurrentAnswer();
    currentQuestionIndex = index;
    loadQuestion(currentQuestionIndex);
}

function saveCurrentAnswer() {
    const selectedAnswer = document.querySelector('input[name="question1"]:checked');
    if (selectedAnswer) {
        answers[currentQuestionIndex] = selectedAnswer.value;
        updateQuestionNavigation();
    }
}

function loadQuestion(index) {
    // Update current question display
    document.getElementById('current-question').textContent = index + 1;

    // Update navigation
    updateQuestionNavigation();

    // Update progress
    const progress = ((index + 1) / totalQuestions) * 100;
    document.querySelector('.progress-bar').style.width = progress + '%';
    document.querySelector('.progress-bar').setAttribute('aria-valuenow', progress);
    document.querySelector('.progress + div .small:last-child').textContent = Math.round(progress) + '% Complete';

    // Update navigation buttons
    document.querySelector('button[onclick="previousQuestion()"]').disabled = index === 0;
    document.querySelector('button[onclick="nextQuestion()"]').textContent =
        index === totalQuestions - 1 ? 'Finish' : 'Next';
}

function updateQuestionNavigation() {
    const navButtons = document.querySelectorAll('.question-number');
    navButtons.forEach((btn, index) => {
        btn.className = 'question-number';
        if (index === currentQuestionIndex) {
            btn.classList.add('current');
        } else if (answers[index]) {
            btn.classList.add('answered');
        } else {
            btn.classList.add('unanswered');
        }
    });
}

function markForReview() {
    alert('Question marked for review');
}

function pauseExam() {
    if (confirm('Are you sure you want to pause this exam? Your progress will be saved.')) {
        window.location.href = '{% url 'current-exams' %}';
    }
}

function submitExam() {
    const answeredCount = Object.keys(answers).length;
    const unansweredCount = totalQuestions - answeredCount;

    let message = `You have answered ${answeredCount} out of ${totalQuestions} questions.`;
    if (unansweredCount > 0) {
        message += `\n${unansweredCount} questions remain unanswered.`;
    }
    message += '\n\nAre you sure you want to submit your exam?';

    if (confirm(message)) {
        alert('Exam submitted successfully!');
        window.location.href = '{% url 'student-results' %}';
    }
}

// Initialize
generateQuestionNav();
updateTimer();
</script>
</body>
</html>
